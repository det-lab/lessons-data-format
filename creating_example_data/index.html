
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../construct_basics/">
      
      
        <link rel="next" href="../kaitai_next_steps/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.2.7">
    
    
      
        <title>6. Creating Example Data - Custom data format</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.046329b4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#objectives" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Custom data format" class="md-header__button md-logo" aria-label="Custom data format" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Custom data format
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6. Creating Example Data
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Custom data format" class="md-nav__button md-logo" aria-label="Custom data format" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Custom data format
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../filetype/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. File types
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../kaitai_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Kaitai basics
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../construct_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Construct basics
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    6. Creating Example Data
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    6. Creating Example Data
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-creating-example-data" class="md-nav__link">
    6: Creating Example Data
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../kaitai_next_steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Kaitai Next Steps
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../construct_next_steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Construct Next Steps
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../conclusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Conclusion
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-creating-example-data" class="md-nav__link">
    6: Creating Example Data
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h3 id="objectives">Objectives:</h3>
<ul>
<li>Create fake data on which to practice our understandings of Kaitai and Construct.</li>
</ul>
<h1 id="6-creating-example-data">6: Creating Example Data</h1>
<p>Now that we have the basics down, let's try putting it all together. To do this, let's fabricate some data, save that data in a binary file, and then define the structure for that data in both Kaitai and Construct. After that, we can compile our formats and begin to manipulate and work with this data.</p>
<p>Let's say that the data that we're taking comes as a waveform in a binary file. We can pretend that we're measuring vibrations through some material, or current intensity in some electrical system, or something like that. As we're fabricating data, not actually taking measurements, the justification doesn't really matter. </p>
<p>For this example we'll be working in Python as it is necessary for using Construct. If you have yet to install an IDE, a link and some instructions were provided in the <a href="/setup/">setup section (2.2)</a> to install the Spyder environment.</p>
<p>Let's say that for some reason we want to break our data into 3 different sections depending on the intensity. The first section can describe the entire wave form, the second can capture only some mid-range values, and the third section captures only the most intense values. In real life, this could translate to three different sensors that each have different sensitivities being used to gather our data.</p>
<p>First, we'll need to make sure that all of the necessary libraries are installed and imported. For this data, we'll need the numpy library and the struct (which is different from Construct) library. Optionally, we can also include matplotlib in order to plot our simulated data. To check if you already have these libraries installed, open your IDE's terminal and enter:</p>
<pre><code>pip list
</code></pre>
<p>This will return an alphabetical list of all currently installed packages/modules that your install of Python has access to, as well as their version numbers. Simply scroll through the result to see if <code>matplotlib</code>, <code>numpy</code>, and <code>python-struct</code> are installed, and if not, run:</p>
<pre><code>pip install numpy
pip install matplotlib
pip install python_struct
</code></pre>
<p>You should now be free to create a new <code>.py</code> or <code>.ipynb</code> file, named something like "example_data". Feel free to take a look at the final product of this section to follow along with at <a href="https://github.com/det-lab/lessons-data-format/blob/gh-pages/examples/example_data.ipynb">this page's github</a>.  </p>
<p>At the beginning of your new file, import the necessary modules using the commands:</p>
<pre><code>import numpy as np
import struct
import matplotlib.pyplot as plt
</code></pre>
<p>Keep in mind that most IDEs will require you to save the file before allowing you to run it. Now, let's create 6 different arrays, one for each x and y value that is being selected from each desired section.</p>
<pre><code>full_x = []
full_y = []

mid_x = []
mid_y = []

peak_x = []
peak_y = []
</code></pre>
<p>We'll then want to populate these arrays with their respective data. Let's create a <code>for</code> loop which will create data points for a wave using an equation. For this example, I'll be creating a function that is defined from <code>x=-5</code> to <code>x=5</code>, creating a y data point every increment of <code>0.0001</code> on the x axis, meaning the full data will contain 100000 points. </p>
<p>The actual function chosen for this example doesn't matter much as long as it's valid within the range you choose. You should be able to simply plot a cosine or sin function with arbitrary limits without running into any issues as long as your computer can handle the number of data points you create. In fact, mixing things up a bit and trying a different equation than is shown here is encouranged! Doing so while referencing the documentation pages for Construct and Kaitai will allow you to find any holes in what this lesson has the space to offer while allowing you to fill them using your own troubleshooting abilities.</p>
<p>For my function, we have:</p>
<pre><code>for i in np.arange(-5,5,0.0001):
  # Function that is being plotted
  n = (np.cos((2 * np.pi * i**2)/(i**2 + i))) * np.sin(i)

  # Put every point in full_x and full_y
  full_x.append(i)
  full_y.append(n)

  # Select only mid range points
  if n**2 &lt; 0.3:
    mid_x.append(i)
    mid_y.append(n)

  # Select only extrema
  if n**2 &gt; 0.65:
    peak_x.append(i)
    peak_y.append(n)
</code></pre>
<p>You could now plot the three graphs if you wish to see what these produce by using:</p>
<pre><code>plt.plot(full_x, full_y)
plt.show()

plt.plot(mid_x, mid_y)
plt.show()

plt.scatter(peak_x, peak_y, s=1)
plt.show()
</code></pre>
<p>The resulting graphs should look like:</p>
<p><img alt="full" src="../images/full-graph.png" />
<img alt="mid" src="../images/mid-graph.png" />
<img alt="peak" src="../images/peak-graph.png" /></p>
<p>Next, we'll want to load all of our wave data into separate numpy arrays. This allows us to set the datatype so each x and y value can be saved across a custom number of bytes. </p>
<p>Feel free to experiment with the byte size choices as well. You can save the data across 8 bytes by using <code>float64</code> for high resolution, 4 bytes by using <code>float32</code>, <code>float16</code> for 2 bytes, or <code>float8</code> for 1 byte. Maybe it would make sense for your "experiment" if the full_x and full_y data were saved with the highest resolution, with each successive drop in sample size also dropping the resolution. You could even decide to flatten every point into integers if you wish by using <code>uint64</code>, <code>uint32</code>, and so on. Even imaginary numbers can be captured if you choose to visualize a complex equation, with the options beginning at <code>complex64</code> and doubling until <code>complex256</code>. In any case, your arrays should hopefully look similar to:</p>
<pre><code># Save data to numpy arrays
full_y_data = np.array(full_y, dtype=np.float32)
full_x_data = np.array(full_x, dtype=np.float32)

mid_y_data = np.array(mid_y, dtype=np.float32)
mid_x_data = np.array(mid_x, dtype=np.float32)

peak_y_data = np.array(peak_y, dtype=np.float32)
peak_x_data = np.array(peak_x, dtype=np.float32)
</code></pre>
<p>The next and final step of creating our example data is to write everything we've done so far to a new <code>.test</code> (or whatever extension you choose) file. It is also often useful to include the length of each section somewhere in our final file to make it easier to select the full arrays when compiling. The simplest choice is to include the length of every array at the beginning of the file, but you could also put each length before its respective section. There are other ways to manage this kind of data, but including the lengths this way avoids some of the more convoluted methods, such as giving each array a specific signature or creating termination strings. </p>
<p>Here's what it looks like to write our data in this way:</p>
<pre><code># Save data to binary file
with open('wave_data.test', 'wb') as f:
  # Write array lengths to file as integers
  f.write(struct.pack('I', len(full_y_data)))
  f.write(struct.pack('I', len(mid_y_data)))
  f.write(struct.pack('I', len(peak_y_data)))

  # Write each array to the file
  full_x_data.tofile(f)
  full_y_data.tofile(f)

  mid_x_data.tofile(f)
  mid_y_data.tofile(f)

  peak_x_data.tofile(f)
  peak_y_data.tofile(f)
</code></pre>
<p>We now have a file titled "wave_data.test" saved in the same directory as our python program. The file type can be decided arbitrarily - it used to be the case that type extensions were required to be 3 characters or less, but that standard has since fallen out of use.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>
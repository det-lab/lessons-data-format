
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../04_kaitai_basics/">
      
      
        <link rel="next" href="../06_creating_example_data/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.2.7">
    
    
      
        <title>5. Construct basics - Custom data format</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.046329b4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#objectives" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Custom data format" class="md-header__button md-logo" aria-label="Custom data format" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Custom data format
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              5. Construct basics
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Custom data format" class="md-nav__button md-logo" aria-label="Custom data format" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Custom data format
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../00_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../01_introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../02_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../03_filetype/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. File types
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../04_kaitai_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Kaitai basics
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    5. Construct basics
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    5. Construct basics
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-defining-the-structure-in-construct" class="md-nav__link">
    5: Defining the Structure in Construct
  </a>
  
    <nav class="md-nav" aria-label="5: Defining the Structure in Construct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-struct-basics" class="md-nav__link">
    5.1: Struct basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-building-gifpy" class="md-nav__link">
    5.2: Building gif.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../06_creating_example_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Creating Example Data
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../07_kaitai_next_steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Kaitai Next Steps
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../06_construct_next_steps.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Construct Next Steps
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../09_conclusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Conclusion
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../10_appendix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-defining-the-structure-in-construct" class="md-nav__link">
    5: Defining the Structure in Construct
  </a>
  
    <nav class="md-nav" aria-label="5: Defining the Structure in Construct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-struct-basics" class="md-nav__link">
    5.1: Struct basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-building-gifpy" class="md-nav__link">
    5.2: Building gif.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h3 id="objectives">Objectives:</h3>
<ul>
<li>Understand how to begin working with Construct and its basic structure.</li>
<li>Explore the Construct description of the GIF file type to see it in action.</li>
</ul>
<h1 id="5-defining-the-structure-in-construct">5: Defining the Structure in Construct</h1>
<p>Construct is a Python library for declaratively describing and parsing binary data formats. Its functionality is similar to Kaitai Struct, but it uses Python code and programmatic constructs. In Construct, you define <code>Structs</code> (structures) that describe how to interpret sections of a binary file. These <code>Structs</code> can be combined and nested to represent complex file formats, ultimately building up to a main <code>Struct</code> that captures the entire file's structure.</p>
<h2 id="51-struct-basics">5.1: Struct basics</h2>
<p>A <code>Struct</code> in Construct is a collection of ordered fields, each with a name and a type. Fields are parsed or built in the order they are defined. When parsing, Construct returns a dictionary-like object with keys matching the field names. Unlike Kaitai, field names are optional in Construct, but naming fields makes the resulting data much easier to work with.</p>
<p>Let's recreate the dimensions example from the Kaitai section. Here is how you would define a <code>width_and_height</code> <code>Struct</code> in Construct:</p>
<pre><code class="language-python">width_and_height = Struct(
    &quot;width&quot; / Int16ul,
    &quot;height&quot; / Int16ul
)
</code></pre>
<p>Here, <code>Int16ul</code> means an <strong>Int</strong>eger of <strong>16</strong> <strong>u</strong>nsigned bits in <strong>l</strong>ittle-endian format. You can then reuse this <code>width_and_height</code> struct in other structures:</p>
<pre><code class="language-python">dimensions = Struct(
    &quot;w_and_h&quot; / width_and_height
)
</code></pre>
<p>This modular approach allows you to build up complex file formats from smaller, reusable pieces.</p>
<h2 id="52-building-gifpy">5.2: Building gif.py</h2>
<p>Let's look at how Construct can be used to describe the GIF file format, using the <a href="https://github.com/construct/construct/blob/master/deprecated_gallery/gif.py">gif.py</a> example from Construct's GitHub repository.</p>
<p>Unlike Kaitai, where types can be declared in any order, Python requires that each <code>Struct</code> be defined before it is referenced. This means you typically define the smallest components first and then combine them into larger structures. This means that when examining the structure of <code>Structs</code>, it often makes sense to start from the final defined <code>Struct</code> to see what building blocks it uses.</p>
<p>Here is the top-level <code>gif_file</code> struct, which represents the entire GIF file:</p>
<pre><code class="language-python">gif_file = Struct(
    &quot;signature&quot; / Const(b&quot;GIF&quot;),
    &quot;version&quot; / Const(b&quot;89a&quot;),
    &quot;logical_screen&quot; / gif_logical_screen,
    &quot;data&quot; / GreedyRange(gif_data),
    # &quot;trailer&quot; / Const(0x3B, Int8ul)  # Optional: GIF file terminator
)
</code></pre>
<ul>
<li><code>Const(b"GIF")</code> and <code>Const(b"89a")</code> ensure the file starts with the correct signature and version, similar to the <code>magic</code> keyword in Kaitai. However, this also means it will fail to parse if the version number is anything other than <code>89a</code>.</li>
<li><code>logical_screen</code> and <code>data</code> are parsed using other structs defined above <code>gif_file</code>.</li>
<li><code>GreedyRange(gif_data)</code> repeats the <code>gif_data</code> struct until the end of the file.</li>
</ul>
<p>Now, let's look at the <code>gif_logical_screen</code> struct:</p>
<pre><code class="language-python">gif_logical_screen = Struct(
    &quot;width&quot; / Int16ul,
    &quot;height&quot; / Int16ul,
    &quot;flags&quot; / BitStruct(
        &quot;global_color_table&quot; / Bit,
        &quot;color_resolution&quot; / BitsInteger(3),
        &quot;sort_flag&quot; / Bit,
        &quot;global_color_table_bpp&quot; / BitsInteger(3),
    ),
    &quot;bgcolor_index&quot; / Int8ul,
    &quot;pixel_aspect_ratio&quot; / Int8ul,
    &quot;palette&quot; / If(this.flags.global_color_table,
        Array(lambda this: 2**(this.flags.global_color_table_bpp + 1),
            Struct(
                &quot;R&quot; / Int8ul,
                &quot;G&quot; / Int8ul,
                &quot;B&quot; / Int8ul,
            )
        )
    ),
)
</code></pre>
<ul>
<li><code>BitStruct</code> allows you to parse individual bits within a byte, which is useful for fields like <code>flags</code> that pack multiple values into a single byte.</li>
<li>The <code>palette</code> field is only present if <code>global_color_table</code> is <code>True</code>. Its length is determined by the value of <code>global_color_table_bpp</code>.</li>
</ul>
<p>The <code>data</code> section of the GIF file is parsed using a combination of <code>Struct</code>, <code>Switch</code>, and <code>GreedyRange</code>:</p>
<pre><code class="language-python">gif_data = Struct(
    &quot;introducer&quot; / Int8ul,
    &quot;data&quot; / Switch(this.introducer, {
        0x21: extension,
        0x2C: image_descriptor,
    })
)
</code></pre>
<ul>
<li>The <code>introducer</code> byte determines whether the next section is an extension or an image descriptor.</li>
<li><code>Switch</code> selects the appropriate struct based on the value of <code>introducer</code>.</li>
<li>Each of these sub-structs (<code>extension</code>, <code>image_descriptor</code>) is defined elsewhere in the file.</li>
</ul>
<p>As mentioned earlier, having <code>GreedyRange(gif_data)</code> in the top-level struct repeats this process for each data block in the file, allowing Construct to parse the entire sequence of GIF blocks.</p>
<p>This modular, programmatic approach makes Construct powerful for describing binary formats in Python. While Kaitai uses a declarative YAML-based syntax, Construct leverages Python's syntax and logic, which can be more flexible for complex parsing tasks.</p>
<hr />
<p>Now that you have seen how to describe file formats in both Kaitai and Construct, the next step is to create your own custom data format and try parsing it using these tools. Continue to the next section to learn how to generate and work with example data.</p>
<hr />
<p>Continue to <a href="../06_creating_example_data/">Creating Example Data</a> to generate and save your own binary data.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>
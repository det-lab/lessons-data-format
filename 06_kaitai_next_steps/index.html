
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../05_creating_example_data/">
      
      
        <link rel="next" href="../07_construct_next_steps/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.2.7">
    
    
      
        <title>Kaitai Next Steps - Custom data format</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.046329b4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#objectives" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Custom data format" class="md-header__button md-logo" aria-label="Custom data format" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Custom data format
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Kaitai Next Steps
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Custom data format" class="md-nav__button md-logo" aria-label="Custom data format" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Custom data format
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../01_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../02_filetype/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File types
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../03_kaitai_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kaitai basics
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../04_construct_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Construct basics
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../05_creating_example_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating Example Data
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Kaitai Next Steps
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Kaitai Next Steps
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-describing-the-data-in-kaitai" class="md-nav__link">
    7: Describing the Data in Kaitai
  </a>
  
    <nav class="md-nav" aria-label="7: Describing the Data in Kaitai">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-writing-the-kaitai-description" class="md-nav__link">
    7.1: Writing the Kaitai Description
  </a>
  
    <nav class="md-nav" aria-label="7.1: Writing the Kaitai Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-endianness" class="md-nav__link">
    Setting Endianness
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#describing-the-file-structure" class="md-nav__link">
    Describing the File Structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-parsing-raw-data-with-a-ksy-file" class="md-nav__link">
    7.2: Parsing Raw Data with a .ksy File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-loading-and-using-the-parser-in-python" class="md-nav__link">
    7.3: Loading and Using the Parser in Python
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../07_construct_next_steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Construct Next Steps
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../08_conclusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conclusion
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../09_appendix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-describing-the-data-in-kaitai" class="md-nav__link">
    7: Describing the Data in Kaitai
  </a>
  
    <nav class="md-nav" aria-label="7: Describing the Data in Kaitai">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-writing-the-kaitai-description" class="md-nav__link">
    7.1: Writing the Kaitai Description
  </a>
  
    <nav class="md-nav" aria-label="7.1: Writing the Kaitai Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-endianness" class="md-nav__link">
    Setting Endianness
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#describing-the-file-structure" class="md-nav__link">
    Describing the File Structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-parsing-raw-data-with-a-ksy-file" class="md-nav__link">
    7.2: Parsing Raw Data with a .ksy File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-loading-and-using-the-parser-in-python" class="md-nav__link">
    7.3: Loading and Using the Parser in Python
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h3 id="objectives">Objectives:</h3>
<ul>
<li>Describe our fabricated data in the Kaitai IDE.</li>
<li>Use the description to parse our custom file format.</li>
<li>Return the plots that were created in <a href="../05_creating_example_data/">the previous section</a></li>
</ul>
<h1 id="7-describing-the-data-in-kaitai">7: Describing the Data in Kaitai</h1>
<p>Now that you have created a custom binary file, let's describe its structure using Kaitai Struct. This will allow you to parse and analyze your data with generated code.</p>
<p>If you don't have the <a href="https://ide.kaitai.io/">Kaitai Web IDE</a> open, navigate there and create a new <code>.ksy</code> file (e.g., <code>wave_parser.ksy</code>). You can also reference the <a href="https://github.com/det-lab/lessons-data-format/blob/gh-pages/examples/wave_parser.ksy">example file</a>.</p>
<h2 id="71-writing-the-kaitai-description">7.1: Writing the Kaitai Description</h2>
<h3 id="setting-endianness">Setting Endianness</h3>
<p>By default, the binary data you created was written using your operating system's native endianness. If you want to ensure consistency, you can explicitly set the endianness when generating your arrays in Python:</p>
<pre><code class="language-python"># For little-endian
full_x_data = np.array(full_x, dtype='&lt;float32')  # or '&lt;f4'

# For big-endian
full_x_data = np.array(full_x, dtype='&gt;float32')  # or '&gt;f4'
</code></pre>
<p>In your <code>.ksy</code> file, specify the endianness in the <code>meta</code> section:</p>
<pre><code class="language-yaml">meta:
  id: test
  file-extension: test
  endian: le  # or 'be' for big-endian
</code></pre>
<h3 id="describing-the-file-structure">Describing the File Structure</h3>
<p>Recall that when saving your binary file, you wrote three unsigned 4-byte integers at the start, representing the lengths of each data section. In Kaitai, you can capture these using <code>u4</code> types:</p>
<pre><code class="language-yaml">types:
  full_mid_peak_lens:
    seq:
      - id: full_len
        type: u4
      - id: mid_len
        type: u4
      - id: peak_len
        type: u4
</code></pre>
<p>In the main <code>seq</code> section, reference this type to read the lengths:</p>
<pre><code class="language-yaml">seq:
  - id: lengths
    type: full_mid_peak_lens
</code></pre>
<p>Next, define the structure for each data section. Since each section contains two arrays (<code>x_data</code> and <code>y_data</code>) of <code>float32</code> values, and you know the length from the header, you can use <code>repeat-expr</code>:</p>
<pre><code class="language-yaml">  full_data:
    seq:
      - id: x_data
        type: f4
        repeat: expr
        repeat-expr: _root.lengths.full_len
      - id: y_data
        type: f4
        repeat: expr
        repeat-expr: _root.lengths.full_len

  mid_data:
    seq:
      - id: x_data
        type: f4
        repeat: expr
        repeat-expr: _root.lengths.mid_len
      - id: y_data
        type: f4
        repeat: expr
        repeat-expr: _root.lengths.mid_len

  peak_data:
    seq:
      - id: x_data
        type: f4
        repeat: expr
        repeat-expr: _root.lengths.peak_len
      - id: y_data
        type: f4
        repeat: expr
        repeat-expr: _root.lengths.peak_len
</code></pre>
<p>Finally, add these sections to the main <code>seq</code>:</p>
<pre><code class="language-yaml">  - id: f_data
    type: full_data
  - id: m_data
    type: mid_data
  - id: p_data
    type: peak_data
</code></pre>
<p>Your <code>.ksy</code> file should now fully describe the structure of your binary file.</p>
<h2 id="72-parsing-raw-data-with-a-ksy-file">7.2: Parsing Raw Data with a .ksy File</h2>
<p>To parse your data outside the Web IDE, you need to generate code using the Kaitai Struct Compiler (<code>ksc</code>). If you haven't installed it, see the <a href="../09_appendix/">appendix</a>.</p>
<p>From your terminal, generate the parser (for Python):</p>
<pre><code class="language-sh">ksc -t &lt;language&gt; --outdir &lt;new_foldername&gt; &lt;path/to/your/file.ksy&gt;
</code></pre>
<p>Replacing the parts in the brackets accordingly. For language, the options are: <code>cpp_stl</code>, <code>csharp</code>, <code>java</code>, <code>javascript</code>, <code>perl</code>, <code>php</code>, <code>python</code>, <code>ruby</code>, or <code>all</code>. For this example, we'll be running:</p>
<pre><code class="language-sh">ksc -t python --outdir wave_test wave_parser.ksy
</code></pre>
<p>This will create a folder (<code>wave_test</code>) containing a Python file (<code>test.py</code>).</p>
<h2 id="73-loading-and-using-the-parser-in-python">7.3: Loading and Using the Parser in Python</h2>
<p>Make sure your generated parser and your binary data file are in the same directory or update your import paths accordingly.</p>
<p>Example usage in Python:</p>
<pre><code class="language-python">from pathlib import Path
from wave_test.test import *  # Replace with the actual class name from your .ksy meta:id
import matplotlib.pyplot as plt

raw_data = Path('wave_data.test')
wave_data = Test.from_file(raw_data)

# Access lengths
f_length = wave_data.lengths.full_len
m_length = wave_data.lengths.mid_len
p_length = wave_data.lengths.peak_len
print(f_length, m_length, p_length)

# Access and plot full data
full_x = wave_data.f_data.x_data
full_y = wave_data.f_data.y_data
plt.plot(full_x, full_y)
plt.title(&quot;Full Data&quot;)
plt.show()
</code></pre>
<p>Repeat for <code>m_data</code> and <code>p_data</code> as needed.</p>
<hr />
<p>You have now described and parsed your custom binary file using Kaitai Struct!  Continue to <a href="../07_construct_next_steps/">Construct Next Steps</a> to parse your custom data with the Construct library.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>